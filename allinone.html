<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ChefAI Studio - Smart Recipe Adaptor</title>
    
    <!-- Meta Tags -->
    <meta name="theme-color" content="#0b57d0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --studio-bg: #f8f9fa;
            --studio-sidebar: #ffffff;
            --studio-border: #dadce0;
            --google-blue: #0b57d0;
            --google-blue-hover: #0842a0;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--studio-bg);
            color: #1f1f1f;
            overflow: hidden;
            margin: 0;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        h1, h2, h3, .google-sans {
            font-family: 'Google Sans', sans-serif;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #dadce0;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #bdc1c6;
        }
        .studio-card {
            background: white;
            border: 1px solid var(--studio-border);
            border-radius: 12px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .sidebar-active {
            background-color: #e8f0fe;
            color: var(--google-blue);
        }
        .sidebar-item:hover:not(.sidebar-active) {
            background-color: #f1f3f4;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        html, body {
            overscroll-behavior-y: contain;
        }
    </style>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@^19.2.3",
        "react-dom/client": "https://esm.sh/react-dom@^19.2.3/client",
        "firebase/app": "https://esm.sh/firebase@^12.7.0/app",
        "firebase/auth": "https://esm.sh/firebase@^12.7.0/auth",
        "firebase/firestore": "https://esm.sh/firebase@^12.7.0/firestore",
        "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
        "lucide-react": "https://esm.sh/lucide-react@^0.562.0"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';
        import ReactDOM from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from 'firebase/auth';
        import { getFirestore, collection, doc, onSnapshot, addDoc, updateDoc, deleteDoc, setDoc, Timestamp, query, orderBy } from 'firebase/firestore';
        import { GoogleGenAI, Type } from '@google/genai';
        import { 
            ChefHat, Home, BookOpen, ShoppingCart, UserCircle, Wand2, 
            Search, Clock, CookingPot, Check, Edit3, X, ShoppingBasket, 
            Plus, UploadCloud, Loader2, Trash2, Sparkles, Scale, Send, 
            Info, Link as LinkIcon, ArrowRightLeft, Package, ArrowLeft,
            Layers, ClipboardCheck, BarChart3, ChevronDown, ChevronUp,
            Terminal, Zap, Mic, ArrowUp, Settings2, Minus, ChevronRight, 
            Save, History, Database, Key, CloudOff, Lock, ExternalLink
        } from 'lucide-react';

        // --- Helper: Safe API Key Access ---
        const getSafeEnvKey = () => {
            if (typeof process !== 'undefined' && process.env && process.env.API_KEY) {
                return process.env.API_KEY;
            }
            return undefined;
        };

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyBzpBV8owQ5VbHmaOasDXzn1fbnfzG7fU8",
            authDomain: "chefai-dd91e.firebaseapp.com",
            projectId: "chefai-dd91e",
            storageBucket: "chefai-dd91e.firebasestorage.app",
            messagingSenderId: "382886206236",
            appId: "1:382886206236:web:48c46f20dc762e05a2b8d9"
        };
        const firebaseApp = initializeApp(firebaseConfig);
        const auth = getAuth(firebaseApp);
        const db = getFirestore(firebaseApp);
        const APP_ID = 'chef-ai-v1';

        // --- Gemini Service Logic ---
        const recipeSchema = {
            type: Type.OBJECT,
            properties: {
                title: { type: Type.STRING },
                emoji: { type: Type.STRING },
                summary: { type: Type.STRING },
                ingredients: {
                    type: Type.ARRAY,
                    items: {
                        type: Type.OBJECT,
                        properties: {
                            name: { type: Type.STRING },
                            quantity: { type: Type.NUMBER },
                            unit: { type: Type.STRING },
                        },
                        required: ['name', 'quantity', 'unit'],
                        propertyOrdering: ['name', 'quantity', 'unit'],
                    }
                },
                instructions: { type: Type.ARRAY, items: { type: Type.STRING } },
                extractedTips: { type: Type.ARRAY, items: { type: Type.STRING } },
                aiSuggestions: { type: Type.ARRAY, items: { type: Type.STRING } }
            },
            required: ['title', 'emoji', 'summary', 'ingredients', 'instructions', 'extractedTips', 'aiSuggestions'],
            propertyOrdering: ['title', 'emoji', 'summary', 'ingredients', 'instructions', 'extractedTips', 'aiSuggestions'],
        };

        const geminiService = {
            async processRecipe(recipeInput, preferences) {
                const key = getSafeEnvKey();
                const ai = new GoogleGenAI({ apiKey: key || '' });
                const response = await ai.models.generateContent({
                    model: "gemini-3-pro-preview",
                    contents: recipeInput,
                    config: {
                        systemInstruction: `You are a professional culinary AI. User Prefs: "${preferences}". Rules: 1. Keep Title Original. 2. Units: Metric. 3. Source English: Translate Ingredients ONLY to Trad Chinese, keep Instructions/Units in English. 4. Non-English: Translate All to Trad Chinese. 5. Tips: Add 3 NEW professional Trad Chinese suggestions.`,
                        responseMimeType: "application/json",
                        responseSchema: recipeSchema,
                    },
                });
                return JSON.parse((response.text || "{}").trim());
            },
            async generateGenieIdeas(ingredients, preferences) {
                const key = getSafeEnvKey();
                const ai = new GoogleGenAI({ apiKey: key || '' });
                const response = await ai.models.generateContent({
                    model: "gemini-3-flash-preview",
                    contents: `Ingredients: "${ingredients}"`,
                    config: {
                        systemInstruction: `Generate 5 creative recipe ideas. Prefs: "${preferences}". Titles: English. Summaries: Trad Chinese. Emoji: One.`,
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: Type.ARRAY,
                            items: {
                                type: Type.OBJECT,
                                properties: { title: { type: Type.STRING }, summary: { type: Type.STRING }, emoji: { type: Type.STRING } },
                                required: ['title', 'summary', 'emoji'],
                                propertyOrdering: ['title', 'summary', 'emoji']
                            }
                        }
                    },
                });
                return JSON.parse((response.text || "[]").trim());
            },
            async refineRecipe(recipe, refinePrompt) {
                const key = getSafeEnvKey();
                const ai = new GoogleGenAI({ apiKey: key || '' });
                const response = await ai.models.generateContent({
                    model: "gemini-3-pro-preview",
                    contents: `Recipe: ${JSON.stringify(recipe)}\nGoal: "${refinePrompt}"`,
                    config: {
                        systemInstruction: `Generate 3 professional culinary suggestions in Trad Chinese for this specific goal.`,
                        responseMimeType: "application/json",
                        responseSchema: { type: Type.ARRAY, items: { type: Type.STRING } },
                    },
                });
                return JSON.parse((response.text || "[]").trim());
            }
        };

        // --- Helper: Components ---
        const SectionHeader = ({ icon: Icon, title, extra }) => (
            <div className="h-10 border-b border-[#dadce0] flex items-center justify-between px-4 bg-[#f8f9fa] shrink-0 rounded-t-xl">
                <div className="flex items-center gap-2 text-[11px] font-bold text-[#444746] uppercase tracking-wider">
                    <Icon className="w-3.5 h-3.5 text-[#0b57d0]" />
                    <span>{title}</span>
                </div>
                {extra}
            </div>
        );

        const NavButton = ({ active, icon, onClick, label }) => (
            <button 
                onClick={onClick}
                className={`w-full px-3 py-2 rounded-lg flex items-center gap-3 transition-colors text-sm font-medium sidebar-item ${
                    active ? 'sidebar-active text-[#0b57d0]' : 'text-[#444746]'
                }`}
            >
                {React.cloneElement(icon, { className: 'w-5 h-5' })}
                <span className="truncate">{label}</span>
            </button>
        );

        // --- Main Hook: useChefAI ---
        function useChefAI() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('home');
            const [preferences, setPreferences] = useState('');
            const [recipeInput, setRecipeInput] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [activeRecipe, setActiveRecipe] = useState(null);
            const [isEditing, setIsEditing] = useState(false);
            const [scalingFactor, setScalingFactor] = useState(1);
            const [refining, setRefining] = useState(false);
            const [refinePrompt, setRefinePrompt] = useState('');
            const [savedRecipes, setSavedRecipes] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [shoppingCart, setShoppingCart] = useState(() => {
                try { return JSON.parse(localStorage.getItem('chefai_cart') || '[]'); } catch(e) { return []; }
            });
            const [checkedIngredients, setCheckedIngredients] = useState(() => {
                try { return new Set(JSON.parse(localStorage.getItem('chefai_checked') || '[]')); } catch(e) { return new Set(); }
            });
            const [genieInput, setGenieInput] = useState('');
            const [genieIdeas, setGenieIdeas] = useState([]);
            const [genieLoading, setGenieLoading] = useState(false);
            const [saving, setSaving] = useState(false);
            const [saveError, setSaveError] = useState('');
            const [refineError, setRefineError] = useState('');

            // AI Status Handling
            const isInsideSandbox = useMemo(() => typeof (window.aistudio) !== 'undefined', []);
            const [hasSelectedKey, setHasSelectedKey] = useState(false);

            useEffect(() => {
                const checkKey = async () => {
                    if (isInsideSandbox && window.aistudio.hasSelectedApiKey) {
                        try {
                            const selected = await window.aistudio.hasSelectedApiKey();
                            setHasSelectedKey(selected);
                        } catch (e) {
                            console.error("Failed to check API key status", e);
                        }
                    }
                };
                checkKey();
            }, [isInsideSandbox]);

            const isAiActive = useMemo(() => {
                const envKey = getSafeEnvKey();
                return isInsideSandbox || !!envKey;
            }, [isInsideSandbox]);

            const needsKeySelection = useMemo(() => {
                const envKey = getSafeEnvKey();
                return isInsideSandbox && !envKey && !hasSelectedKey;
            }, [isInsideSandbox, hasSelectedKey]);

            const handleOpenSelectKey = async () => {
                if (isInsideSandbox && window.aistudio.openSelectKey) {
                    await window.aistudio.openSelectKey();
                    setHasSelectedKey(true); // Assume success per guidelines
                }
            };

            useEffect(() => { localStorage.setItem('chefai_cart', JSON.stringify(shoppingCart)); }, [shoppingCart]);
            useEffect(() => { localStorage.setItem('chefai_checked', JSON.stringify(Array.from(checkedIngredients))); }, [checkedIngredients]);

            useEffect(() => {
                signInAnonymously(auth);
                onAuthStateChanged(auth, u => setUser(u));
            }, []);

            useEffect(() => {
                if (!user) return;
                const unsubPrefs = onSnapshot(doc(db, 'artifacts', APP_ID, 'users', user.uid, 'data', 'preferences'), d => {
                    if(d.exists()) setPreferences(d.data()?.text || '');
                });
                const q = query(collection(db, 'artifacts', APP_ID, 'public', 'data', 'recipes'), orderBy('createdAt', 'desc'));
                const unsubRecipes = onSnapshot(q, s => {
                    setSavedRecipes(s.docs.map(d => ({ id: d.id, ...d.data() })));
                });
                return () => { unsubPrefs(); unsubRecipes(); };
            }, [user]);

            const processRecipeAction = async (inputStr) => {
                if (needsKeySelection) { await handleOpenSelectKey(); }
                const finalInput = typeof inputStr === 'string' ? inputStr : recipeInput;
                if (!finalInput.trim()) return; 
                setLoading(true); setError(''); setActiveRecipe(null);
                try { 
                    const r = await geminiService.processRecipe(finalInput, preferences); 
                    setActiveRecipe({ ...r, sourceUrl: '', coverImage: null, ingredients: r.ingredients || [], instructions: r.instructions || [] }); 
                    setIsEditing(true); 
                } catch (e) { 
                    if (e.message && e.message.includes("Requested entity was not found")) { setHasSelectedKey(false); setError('Key connection lost.'); }
                    else setError('AI extraction failed.'); 
                } finally { setLoading(false); } 
            };
            
            const generateGenieIdeasAction = async () => { 
                if (needsKeySelection) { await handleOpenSelectKey(); }
                if (!genieInput.trim()) return; 
                setGenieLoading(true); setError('');
                try { setGenieIdeas(await geminiService.generateGenieIdeas(genieInput, preferences)); } catch (e) { setError('Synthesis failed.'); } finally { setGenieLoading(false); } 
            };
            
            const selectGenieIdea = async (idea) => { 
                const prompt = `Idea: ${idea.title}. Brief: ${idea.summary}. Ingredients: ${genieInput}`; 
                await processRecipeAction(prompt); 
            };
            
            const handleRefineAction = async () => { 
                if (needsKeySelection) { await handleOpenSelectKey(); }
                if(!refinePrompt.trim()||!activeRecipe) return; 
                setRefining(true); setRefineError('');
                try { 
                    const s = await geminiService.refineRecipe(activeRecipe, refinePrompt); 
                    setActiveRecipe(p=>({...p, aiSuggestions: s, lastRefinement: refinePrompt})); setRefinePrompt(''); 
                } catch(e) { setRefineError('Refinement failed.'); } finally { setRefining(false); } 
            };

            const handleSaveRecipeAction = async () => {
                if (!user || !activeRecipe) return;
                setSaving(true); setSaveError('');
                try {
                    const dataToSave = { ...activeRecipe, authorId: user.uid, createdAt: Timestamp.now() };
                    await addDoc(collection(db, 'artifacts', APP_ID, 'public', 'data', 'recipes'), dataToSave);
                    setActiveRecipe(null); setIsEditing(false); setView('cookbook');
                } catch (e) { setSaveError(`Error: ${e.message}`); } finally { setSaving(false); }
            };

            const handleUpdateRecipeAction = async () => {
                if (!user || !activeRecipe?.id) return;
                setSaving(true); setSaveError('');
                try {
                    const dataToUpdate = { ...activeRecipe };
                    const docId = dataToUpdate.id;
                    delete dataToUpdate.id;
                    await updateDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'recipes', docId), dataToUpdate);
                    setIsEditing(false);
                } catch (e) { setSaveError(`Update Error: ${e.message}`); } finally { setSaving(false); }
            };

            const handleDeleteRecipeAction = (id, e) => {
                e.stopPropagation();
                if (!user || !window.confirm("Delete this recipe?")) return;
                deleteDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'recipes', id)).catch(console.error);
            };

            const addToCart = (recipe, factor) => {
                setShoppingCart(prev => [...prev, { id: Math.random().toString(36).substring(2, 9), recipeId: recipe.id, title: recipe.title, ingredients: recipe.ingredients, scalingFactor: factor }]);
                setActiveRecipe(null);
            };

            const removeFromCart = (id) => setShoppingCart(p => p.filter(i => i.id !== id));
            const updateCartItemFactor = (id, f) => { if (f > 0) setShoppingCart(p => p.map(i => i.id === id ? { ...i, scalingFactor: f } : i)); };
            const clearCart = () => { setShoppingCart([]); setCheckedIngredients(new Set()); };

            const consolidatedList = useMemo(() => {
                const list = {};
                shoppingCart.forEach(item => item.ingredients.forEach(ing => {
                    const k = `${ing.name.toLowerCase()}|${ing.unit.toLowerCase()}`;
                    const scaled = (Number(ing.quantity) || 0) * (Number(item.scalingFactor) || 1);
                    if (list[k]) list[k].quantity += scaled;
                    else list[k] = { ...ing, quantity: scaled };
                }));
                return Object.values(list).sort((a,b) => {
                    const kA = `${a.name.toLowerCase()}|${a.unit.toLowerCase()}`;
                    const kB = `${b.name.toLowerCase()}|${b.unit.toLowerCase()}`;
                    const cA = checkedIngredients.has(kA);
                    const cB = checkedIngredients.has(kB);
                    if (cA === cB) return a.name.localeCompare(b.name);
                    return cA ? 1 : -1;
                });
            }, [shoppingCart, checkedIngredients]);

            const { toBuyCount, doneCount } = useMemo(() => {
                let toBuyCount = 0; let doneCount = 0;
                consolidatedList.forEach(ing => {
                    const k = `${ing.name.toLowerCase()}|${ing.unit.toLowerCase()}`;
                    if (checkedIngredients.has(k)) doneCount++; else toBuyCount++;
                });
                return { toBuyCount, doneCount };
            }, [consolidatedList, checkedIngredients]);

            const toggleIngredientCheck = (k) => setCheckedIngredients(p => { const n = new Set(p); if(n.has(k)) n.delete(k); else n.add(k); return n; });

            const filteredRecipes = useMemo(() => {
                const term = searchTerm.toLowerCase();
                return savedRecipes.filter(r => r.title?.toLowerCase().includes(term) || r.ingredients?.some(i => i.name.toLowerCase().includes(term)));
            }, [savedRecipes, searchTerm]);

            return {
                user, view, setView, preferences, setPreferences, recipeInput, setRecipeInput,
                loading, error, activeRecipe, setActiveRecipe, isEditing, setIsEditing,
                scalingFactor, setScalingFactor, refining, refinePrompt, setRefinePrompt,
                savedRecipes, searchTerm, setSearchTerm, shoppingCart, clearCart,
                processRecipeAction, handleRefineAction, handleSaveRecipeAction, handleUpdateRecipeAction, handleDeleteRecipeAction,
                addToCart, removeFromCart, updateCartItemFactor, consolidatedList, toBuyCount, doneCount, toggleIngredientCheck,
                checkedIngredients, filteredRecipes, genieInput, setGenieInput, genieIdeas, genieLoading, generateGenieIdeasAction, selectGenieIdea,
                isAiActive, needsKeySelection, handleOpenSelectKey, saving, saveError, refineError
            };
        }

        // --- View Components ---
        const HomeView = ({ recipeInput, setRecipeInput, preferences, setPreferences, processRecipeAction, loading, error, isAiActive, needsKeySelection, handleOpenSelectKey }) => (
            <div className="h-full flex flex-col animate-fade-in max-w-5xl mx-auto pb-6">
                <div className="mb-4 studio-card bg-white h-11 px-4 flex items-center justify-between border-[#dadce0]">
                    <div className="flex items-center gap-3">
                        <div className="w-7 h-7 rounded-lg bg-[#e8f0fe] flex items-center justify-center">
                            <Settings2 className="w-3.5 h-3.5 text-[#0b57d0]" />
                        </div>
                        <span className="text-[12px] font-bold text-[#1f1f1f] google-sans">System Instruction</span>
                    </div>
                </div>

                {!isAiActive && !needsKeySelection && (
                    <div className="mb-4 p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-center gap-3">
                        <CloudOff className="w-5 h-5 text-amber-600" />
                        <div className="flex-1">
                            <p className="text-[12px] font-bold text-amber-900 uppercase">AI Model Offline</p>
                            <p className="text-[11px] text-amber-700">Environment key missing. Standing by in offline mode.</p>
                        </div>
                    </div>
                )}

                {needsKeySelection && (
                    <div className="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-xl flex items-center gap-4">
                        <Key className="w-5 h-5 text-[#0b57d0]" />
                        <div className="flex-1">
                            <p className="text-[12px] font-bold text-[#0b57d0] uppercase">Connect Gemini</p>
                            <p className="text-[11px] text-[#444746]">Select an API key to enable AI adapters.</p>
                        </div>
                        <button onClick={handleOpenSelectKey} className="px-4 py-2 bg-[#0b57d0] text-white text-[12px] font-bold rounded-lg active:scale-95">Connect</button>
                    </div>
                )}

                <div className={`flex-1 flex flex-col studio-card bg-white overflow-hidden relative min-h-[300px] ${(needsKeySelection || !isAiActive) ? 'opacity-60' : ''}`}>
                    <div className="h-9 border-b border-[#dadce0] flex items-center px-4 bg-[#f8f9fa] shrink-0 justify-between">
                        <div className="flex items-center gap-2 text-[10px] font-bold text-[#444746] uppercase"><Terminal className="w-3 h-3 text-[#0b57d0]" /><span>Recipe Prompt</span></div>
                        <div className="text-[9px] font-bold text-[#0b57d0] bg-[#e8f0fe] px-2 py-0.5 rounded uppercase flex items-center gap-1"><Zap className="w-2.5 h-2.5" /><span>Gemini 3 Pro</span></div>
                    </div>
                    <textarea 
                        disabled={!isAiActive}
                        className="flex-1 w-full p-5 text-[15px] outline-none resize-none placeholder:text-[#bdc1c6] leading-relaxed text-[#1f1f1f] bg-transparent"
                        placeholder={isAiActive ? "Paste a recipe URL or details..." : "AI disabled."}
                        value={recipeInput}
                        onChange={(e) => setRecipeInput(e.target.value)}
                    />
                    <div className="h-14 border-t border-[#dadce0] bg-[#f8f9fa] flex items-center justify-between px-4 shrink-0">
                        <div className="flex-1 truncate text-[10px] text-[#8e918f]">{error || 'Enter recipe details to begin adaptation.'}</div>
                        <button 
                            onClick={processRecipeAction}
                            disabled={loading || !recipeInput.trim() || (!isAiActive && !needsKeySelection)}
                            className="bg-[#0b57d0] text-white rounded-xl px-5 h-9 font-bold text-[12px] flex items-center gap-2 disabled:bg-[#f1f3f4] disabled:text-[#bdc1c6] active:scale-95"
                        >
                            {loading ? <Loader2 className="w-3.5 h-3.5 animate-spin" /> : <Sparkles className="w-3.5 h-3.5" />}
                            {loading ? 'Running...' : (needsKeySelection ? 'Connect & Run' : 'Run Adapter')}
                        </button>
                    </div>
                </div>
            </div>
        );

        const GenieView = ({ genieInput, setGenieInput, genieIdeas, genieLoading, generateGenieIdeasAction, selectGenieIdea, loadingRecipe, error, isAiActive }) => (
            <div className="h-full flex flex-col max-w-4xl mx-auto relative animate-fade-in">
                <div className="px-2 mb-4 flex items-center justify-between">
                    <div><h2 className="text-lg font-bold text-[#1f1f1f] google-sans">Kitchen Genie</h2></div>
                    <div className={`flex items-center gap-2 text-[10px] font-bold px-2.5 py-1 rounded-lg border uppercase ${isAiActive ? 'text-[#0b57d0] bg-[#e8f0fe]' : 'text-[#8e918f] bg-[#f1f3f4]'}`}>
                        <Zap className="w-3 h-3" /><span>{isAiActive ? 'Creative Mode' : 'Offline'}</span>
                    </div>
                </div>
                <div className="flex-1 overflow-y-auto custom-scrollbar px-2 space-y-3 pb-48 pt-2">
                    {genieIdeas.length > 0 ? genieIdeas.map((idea, idx) => (
                        <button key={idx} onClick={() => selectGenieIdea(idea)} disabled={loadingRecipe || !isAiActive} className="w-full text-left p-4 rounded-xl bg-white border border-[#dadce0] hover:border-[#0b57d0] flex gap-4 disabled:opacity-50 group">
                            <div className="w-12 h-12 bg-[#f8f9fa] rounded-lg flex items-center justify-center text-2xl shrink-0 border border-[#dadce0] group-hover:scale-105 transition-transform">{idea.emoji}</div>
                            <div className="flex-1 min-w-0"><h4 className="text-[14px] font-bold text-[#1f1f1f] truncate group-hover:text-[#0b57d0]">{idea.title}</h4><p className="text-[12px] text-[#444746] line-clamp-2 italic">{idea.summary}</p></div>
                            <div className="self-center">{loadingRecipe ? <Loader2 className="w-4 h-4 animate-spin" /> : <ChevronRight className="w-4 h-4 text-[#bdc1c6]" />}</div>
                        </button>
                    )) : (
                        <div className="h-full flex flex-col items-center justify-center text-center p-10 px-4">
                            <div className="w-16 h-16 md:w-20 md:h-20 bg-white border border-[#dadce0] rounded-3xl flex items-center justify-center mb-6 shadow-sm">
                                <CookingPot className="w-8 h-8 md:w-10 md:h-10 text-[#bdc1c6]" />
                            </div>
                            <h3 className="text-lg md:text-xl font-bold text-[#1f1f1f] google-sans tracking-tight">Pantry brainstorming</h3>
                            <p className="text-[13px] text-[#444746] mt-2 max-w-xs text-center leading-relaxed">
                                List the ingredients you have available in the prompt below, and the Genie will conjure creative recipe concepts for your workspace.
                            </p>
                        </div>
                    )}
                </div>
                <div className="absolute bottom-0 left-0 right-0 p-4 pb-8 bg-gradient-to-t from-[#f8f9fa] to-transparent">
                    <div className="bg-white rounded-xl border border-[#dadce0] p-4 flex flex-col gap-2 shadow-lg">
                        <textarea 
                            disabled={!isAiActive}
                            className="w-full bg-transparent border-none outline-none resize-none text-[15px] min-h-[50px] leading-relaxed"
                            placeholder={isAiActive ? "What's in your fridge?" : "Genie is offline..."}
                            value={genieInput}
                            onChange={(e) => setGenieInput(e.target.value)}
                        />
                        <div className="flex justify-end"><button onClick={generateGenieIdeasAction} disabled={genieLoading || !genieInput.trim() || !isAiActive} className="w-10 h-10 bg-[#0b57d0] text-white rounded-lg flex items-center justify-center active:scale-95">{genieLoading ? <Loader2 className="w-5 h-5 animate-spin" /> : <ArrowUp className="w-5 h-5" />}</button></div>
                    </div>
                </div>
            </div>
        );

        const HistoryView = ({ searchTerm, setSearchTerm, filteredRecipes, setActiveRecipe, setIsEditing, setScalingFactor, shoppingCart, addToCart, removeFromCart }) => (
            <div className="h-full flex flex-col gap-6 animate-fade-in">
                <div className="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
                    <div><h2 className="text-xl font-bold text-[#1f1f1f] google-sans">Cookbook</h2><p className="text-[13px] text-[#444746]">Manage your adapted recipe models.</p></div>
                    <div className="relative w-full md:w-80"><Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-[#8e918f]" /><input className="w-full bg-white border border-[#dadce0] rounded-lg pl-10 pr-4 py-2 text-[13px] outline-none focus:border-[#0b57d0]" placeholder="Search recipes..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} /></div>
                </div>
                <div className="flex-1 overflow-y-auto custom-scrollbar pb-24">
                    {filteredRecipes.length > 0 ? (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {filteredRecipes.map(r => {
                                const cartItem = shoppingCart.find(i => i.recipeId === r.id);
                                return (
                                    <div key={r.id} onClick={() => { setActiveRecipe(r); setIsEditing(false); setScalingFactor(1); }} className="studio-card group flex flex-col hover:border-[#0b57d0] cursor-pointer overflow-hidden animate-fade-in">
                                        <div className="relative h-44 bg-[#f8f9fa] shrink-0 border-b border-[#dadce0]">
                                            {r.coverImage ? <img src={r.coverImage} className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center text-5xl">{r.emoji || 'ðŸ¥˜'}</div>}
                                            <button onClick={(e) => { e.stopPropagation(); if(cartItem) removeFromCart(cartItem.id); else addToCart(r, 1); }} className={`absolute top-3 right-3 p-2 rounded-full shadow-lg transition-all ${cartItem ? 'bg-green-600 text-white' : 'bg-white text-[#0b57d0]'}`}>{cartItem ? <Check className="w-4 h-4" /> : <ShoppingCart className="w-4 h-4" />}</button>
                                        </div>
                                        <div className="p-5 flex-1 flex flex-col"><h3 className="text-sm font-bold text-[#1f1f1f] group-hover:text-[#0b57d0] mb-1">{r.title}</h3><p className="text-[12px] text-[#444746] line-clamp-2 italic italic mb-4">{r.summary}</p><div className="flex flex-wrap gap-1.5 mt-auto">{r.ingredients?.slice(0, 2).map((ing, i) => <span key={i} className="text-[9px] font-bold uppercase bg-[#f1f3f4] px-2 py-0.5 rounded text-[#444746]">{ing.name}</span>)}</div></div>
                                    </div>
                                );
                            })}
                        </div>
                    ) : (
                        <div className="h-full flex flex-col items-center justify-center py-24 opacity-30"><CookingPot className="w-12 h-12 mb-4" /><p className="text-sm font-bold uppercase tracking-wider">No Adapters Found</p></div>
                    )}
                </div>
            </div>
        );

        const ShoppingView = ({ shoppingCart, clearCart, removeFromCart, updateCartItemFactor, toBuyCount, doneCount, consolidatedList, toggleIngredientCheck, checkedIngredients, setView }) => (
            <div className="h-full flex flex-col gap-6 animate-fade-in">
                <div className="flex justify-between items-center px-1">
                    <div><h2 className="text-xl font-bold text-[#1f1f1f] google-sans">Shopping List</h2><div className="flex gap-3 text-[12px] text-[#444746] mt-1"><span>{toBuyCount} remaining</span><span className="text-green-600 font-bold">{doneCount} done</span></div></div>
                    <button onClick={clearCart} className="text-[11px] font-bold text-[#ba1a1a] uppercase hover:bg-red-50 px-3 py-1.5 rounded-lg flex items-center gap-2 transition-all"><Trash2 className="w-4 h-4" />Flush</button>
                </div>
                {shoppingCart.length === 0 ? (
                    <div className="flex-1 flex flex-col items-center justify-center opacity-40"><Package className="w-16 h-16 mb-6" /><p className="text-lg font-bold">List Empty</p><button onClick={() => setView('cookbook')} className="mt-4 text-[#0b57d0] font-bold text-sm hover:underline">Browse Cookbook</button></div>
                ) : (
                    <div className="flex-1 flex flex-col lg:flex-row gap-6 items-start overflow-hidden pb-20">
                        <div className="flex-1 w-full studio-card flex flex-col h-full bg-white overflow-hidden">
                            <SectionHeader icon={ClipboardCheck} title="Aggregated List" />
                            <div className="flex-1 overflow-y-auto custom-scrollbar divide-y divide-[#f1f3f4]">
                                {consolidatedList.map((ing, i) => {
                                    const key = `${ing.name.toLowerCase()}|${ing.unit.toLowerCase()}`;
                                    const checked = checkedIngredients.has(key);
                                    return (
                                        <div key={i} onClick={() => toggleIngredientCheck(key)} className={`flex items-center gap-4 px-6 py-4 cursor-pointer hover:bg-[#f8f9fa] group ${checked ? 'opacity-50' : ''}`}>
                                            <div className={`w-5 h-5 rounded-lg border-2 flex items-center justify-center ${checked ? 'bg-[#0b57d0] border-[#0b57d0]' : 'border-[#dadce0]'}`}>{checked && <Check className="w-3.5 h-3.5 text-white" />}</div>
                                            <span className={`text-[14px] flex-1 ${checked ? 'line-through text-[#bdc1c6]' : 'text-[#1f1f1f]'}`}>{ing.name}</span>
                                            <span className="bg-[#e8f0fe] text-[#0b57d0] px-3 py-1 rounded-full text-[11px] font-bold font-mono">{Number(ing.quantity.toFixed(2))} {ing.unit}</span>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                        <div className="w-full lg:w-80 space-y-4 h-full shrink-0">
                            <div className="studio-card p-6 bg-white"><div className="text-[10px] font-bold text-[#8e918f] uppercase mb-4">Analytics</div><div className="text-2xl font-bold mb-2">{Math.round((doneCount / (toBuyCount + doneCount || 1)) * 100)}%</div><div className="h-2 w-full bg-[#f1f3f4] rounded-full overflow-hidden"><div className="h-full bg-[#0b57d0] transition-all" style={{ width: `${(doneCount / (toBuyCount + doneCount || 1)) * 100}%` }}></div></div></div>
                            <div className="studio-card overflow-hidden bg-white shrink-0"><SectionHeader icon={Layers} title="Active Sources" /><div className="divide-y divide-[#f1f3f4]">{shoppingCart.map(item => (<div key={item.id} className="p-4"><div className="flex justify-between items-start mb-2"><span className="text-[13px] font-bold truncate pr-4">{item.title}</span><button onClick={() => removeFromCart(item.id)} className="text-[#bdc1c6] hover:text-red-500"><Trash2 className="w-3.5 h-3.5"/></button></div><div className="flex items-center gap-2"><button onClick={() => updateCartItemFactor(item.id, item.scalingFactor - 0.5)} className="p-1 border rounded"><Minus className="w-3 h-3"/></button><span className="text-[12px] font-mono font-bold w-12 text-center">{item.scalingFactor}x</span><button onClick={() => updateCartItemFactor(item.id, item.scalingFactor + 0.5)} className="p-1 border rounded"><Plus className="w-3 h-3"/></button></div></div>))}</div></div>
                        </div>
                    </div>
                )}
            </div>
        );

        const ProfileView = ({ preferences, setPreferences, savePreferences, recipeCount, cartCount }) => (
            <div className="h-full flex flex-col gap-6 animate-fade-in">
                <div className="flex items-center gap-4"><div className="w-12 h-12 bg-[#0b57d0] rounded-xl flex items-center justify-center shadow-sm"><UserCircle className="w-6 h-6 text-white" /></div><div><h2 className="text-2xl font-bold text-[#1f1f1f] google-sans">Preferences</h2><p className="text-sm text-[#444746]">Personalize your culinary AI behavior.</p></div></div>
                <div className="flex-1 flex flex-col lg:flex-row gap-6">
                    <div className="flex-1 studio-card flex flex-col bg-white overflow-hidden">
                        <SectionHeader icon={Settings2} title="AI Persona Settings" />
                        <div className="p-8 space-y-6">
                            <div className="space-y-2"><label className="text-sm font-medium">Global Adaptation Directives</label><textarea className="w-full h-48 bg-[#f8f9fa] border border-[#dadce0] rounded-xl p-5 text-sm outline-none focus:border-[#0b57d0] leading-relaxed" value={preferences} onChange={(e) => setPreferences(e.target.value)} placeholder="e.g. 'Always use metric', 'Suggest organic swaps'..." /></div>
                            <button onClick={savePreferences} className="bg-[#0b57d0] text-white px-8 py-2.5 rounded-lg text-sm font-medium active:scale-95 flex items-center gap-2"><Save className="w-4 h-4"/>Save Settings</button>
                        </div>
                    </div>
                    <div className="w-full lg:w-80 space-y-6 shrink-0">
                        <div className="studio-card bg-white p-6"><SectionHeader icon={BarChart3} title="Metrics" /><div className="space-y-4 mt-4"><div className="flex items-center gap-4"><History className="w-5 h-5 text-[#0b57d0]"/><div className="text-xl font-bold">{recipeCount} <span className="text-[10px] font-normal uppercase text-[#8e918f]">Adapters</span></div></div><div className="flex items-center gap-4"><Database className="w-5 h-5 text-[#0b57d0]"/><div className="text-xl font-bold">{cartCount} <span className="text-[10px] font-normal uppercase text-[#8e918f]">Payloads</span></div></div></div></div>
                    </div>
                </div>
            </div>
        );

        const RecipeModal = ({ recipe, setRecipe, close, isEditing, setIsEditing, scalingFactor, setScalingFactor, saveRecipe, updateRecipe, saving, saveError, refine, refining, refinePrompt, setRefinePrompt, refineError, shoppingCart, onAddToCart, onRemoveFromCart }) => {
            const formatQty = (n) => Number((n * scalingFactor).toFixed(2));
            const cartItem = shoppingCart.find(i => i.recipeId === recipe.id);
            return (
                <div className="fixed inset-0 z-[60] flex items-end sm:items-center justify-center p-0 sm:p-4 animate-fade-in">
                    <div className="absolute inset-0 bg-black/50 backdrop-blur-sm" onClick={close}></div>
                    <div className="relative bg-[#f8f9fa] w-full max-w-7xl h-[94vh] sm:h-[90vh] sm:rounded-xl overflow-hidden flex flex-col border border-[#dadce0] shadow-2xl">
                        <header className="h-14 border-b border-[#dadce0] bg-white flex items-center justify-between px-6 shrink-0 z-50">
                            <div className="flex items-center gap-3"><span className="text-[15px] font-bold truncate google-sans">{recipe.title || 'Draft'}</span></div>
                            <div className="flex items-center gap-2">
                                {!isEditing && <button onClick={() => cartItem ? onRemoveFromCart(cartItem.id) : onAddToCart(recipe, scalingFactor)} className={`px-3 py-1.5 rounded-lg text-[13px] border ${cartItem ? 'bg-green-50 text-green-600 border-green-200' : 'hover:bg-[#f1f3f4] border-transparent'}`}>{cartItem ? 'Stored' : 'Store'}</button>}
                                <button onClick={() => isEditing ? (recipe.id ? updateRecipe() : saveRecipe()) : setIsEditing(true)} disabled={saving} className="px-3 py-1.5 rounded-lg text-[13px] bg-[#e8f0fe] text-[#0b57d0] border border-[#d2e3fc] flex items-center gap-2">{saving ? <Loader2 className="w-4 h-4 animate-spin"/> : isEditing ? 'Commit' : 'Edit'}</button>
                                <button onClick={close} className="p-2 hover:bg-red-50 hover:text-red-500 rounded-lg"><X className="w-5 h-5" /></button>
                            </div>
                        </header>
                        <div className="flex-1 overflow-y-auto custom-scrollbar p-6">
                            <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
                                <div className="lg:col-span-5 space-y-6">
                                    <div className="studio-card p-6 bg-white flex gap-6">
                                        <div className="w-24 h-24 bg-[#f1f3f4] rounded-xl flex items-center justify-center text-5xl border border-[#dadce0] overflow-hidden">{recipe.coverImage ? <img src={recipe.coverImage} className="w-full h-full object-cover"/> : recipe.emoji || 'ðŸ¥˜'}</div>
                                        <div className="flex-1 space-y-2">
                                            {isEditing ? <input className="w-full text-base font-bold bg-[#f8f9fa] p-2 rounded" value={recipe.title} onChange={e => setRecipe({...recipe, title: e.target.value})}/> : <h2 className="text-xl font-bold google-sans">{recipe.title}</h2>}
                                            <p className="text-[12px] italic text-[#444746] leading-relaxed border-l-2 border-[#0b57d0] pl-3">{recipe.summary}</p>
                                        </div>
                                    </div>
                                    <div className="studio-card bg-white overflow-hidden">
                                        <SectionHeader icon={ShoppingBasket} title="Ingredients" extra={!isEditing && <div className="text-[10px] font-bold bg-[#e8f0fe] px-2 py-1 rounded text-[#0b57d0]">{scalingFactor}x Scaling</div>} />
                                        <div className="divide-y divide-[#f1f3f4]">
                                            {recipe.ingredients.map((ing, i) => (
                                                <div key={i} className="flex justify-between p-4 hover:bg-[#f8f9fa] transition-colors">
                                                    <span className="text-[14px] font-medium">{ing.name}</span>
                                                    <div className="flex items-center gap-1 font-mono font-bold text-[#0b57d0] bg-[#e8f0fe] px-2.5 py-1 rounded-lg text-[12px]">{formatQty(ing.quantity)} {ing.unit}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                <div className="lg:col-span-7 space-y-6">
                                    <div className="studio-card bg-white overflow-hidden">
                                        <SectionHeader icon={ChefHat} title="Workflow Execution" />
                                        <div className="divide-y divide-[#f1f3f4]">
                                            {recipe.instructions.map((step, i) => (
                                                <div key={i} className="flex gap-4 p-5">
                                                    <span className="text-[11px] font-mono font-bold text-[#bdc1c6] pt-1">{String(i+1).padStart(2,'0')}</span>
                                                    <p className="text-[14px] text-[#444746] leading-relaxed">{step}</p>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    {recipe.aiSuggestions?.length > 0 && (
                                        <div className="studio-card bg-white overflow-hidden border-[#d2e3fc]">
                                            <SectionHeader icon={Sparkles} title="AI Insights" />
                                            <div className="p-5 space-y-4">
                                                {recipe.aiSuggestions.map((s, i) => <div key={i} className="flex gap-3 text-[13px] font-medium text-[#1f1f1f]"><Sparkles className="w-4 h-4 text-[#0b57d0] shrink-0"/>{s}</div>)}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                        {!isEditing && (
                            <div className="p-4 bg-white border-t border-[#dadce0] z-50">
                                <div className="max-w-4xl mx-auto flex items-center gap-3 relative">
                                    <textarea className="w-full bg-[#f8f9fa] border border-[#dadce0] rounded-xl px-5 py-3 pr-14 text-[13px] resize-none h-[54px]" placeholder="Refine (e.g. 'Make it vegan', 'Scale for 10 people')..." value={refinePrompt} onChange={e => setRefinePrompt(e.target.value)} />
                                    <button onClick={refine} disabled={refining || !refinePrompt.trim()} className="absolute right-2 top-2 p-2.5 bg-[#0b57d0] text-white rounded-lg active:scale-95 disabled:bg-gray-100">{refining ? <Loader2 className="w-4 h-4 animate-spin"/> : <Send className="w-4 h-4"/>}</button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- Core Application Wrapper ---
        function ChefAIApp() {
            const state = useChefAI();

            if (!state.user) {
                return (
                    <div className="h-screen w-full flex flex-col items-center justify-center bg-white text-[#0b57d0] gap-4">
                        <Loader2 className="w-10 h-10 animate-spin" />
                        <p className="font-medium text-lg google-sans">Initializing Studio...</p>
                    </div>
                );
            }

            return (
                <div className="flex h-screen w-full overflow-hidden">
                    <nav className="hidden md:flex flex-col w-64 bg-white border-r border-[#dadce0] h-full shrink-0">
                        <div className="p-6 flex items-center gap-3"><div className="w-8 h-8 bg-[#0b57d0] rounded-lg flex items-center justify-center shadow-sm"><ChefHat className="w-5 h-5 text-white" /></div><h1 className="font-bold text-lg tracking-tight google-sans">ChefAI Studio</h1></div>
                        <div className="flex-1 px-3 space-y-1">
                            <div className="px-3 pb-2 text-[11px] font-bold text-[#8e918f] uppercase tracking-widest">Workspace</div>
                            <NavButton active={state.view === 'home'} icon={<Home />} onClick={() => state.setView('home')} label="New Adapter" />
                            <NavButton active={state.view === 'genie'} icon={<Wand2 />} onClick={() => state.setView('genie')} label="Kitchen Genie" />
                            <NavButton active={state.view === 'cookbook'} icon={<BookOpen />} onClick={() => state.setView('cookbook')} label="Cookbook" />
                            <NavButton active={state.view === 'shopping'} icon={<ShoppingCart />} onClick={() => state.setView('shopping')} label="Shopping List" />
                            <div className="pt-6 px-3 pb-2 text-[11px] font-bold text-[#8e918f] uppercase tracking-widest">Account</div>
                            <NavButton active={state.view === 'profile'} icon={<UserCircle />} onClick={() => state.setView('profile')} label="Preferences" />
                        </div>
                        <div className="p-4 border-t border-[#dadce0]"><div className="p-3 bg-[#f8f9fa] rounded-xl"><div className="text-[11px] font-medium text-[#8e918f] mb-1">Model: Gemini 3 Pro</div><div className="flex items-center gap-2"><div className={`w-2 h-2 rounded-full ${state.isAiActive ? 'bg-green-500 animate-pulse' : 'bg-amber-500'}`}></div><span className="text-[10px] text-[#444746] font-medium">{state.isAiActive ? 'Ready' : 'Offline Mode'}</span></div></div></div>
                    </nav>

                    <div className="flex-1 flex flex-col min-w-0 bg-[#f8f9fa] relative">
                        <header className="h-12 border-b border-[#dadce0] bg-white flex items-center px-6 shrink-0 z-10"><div className="flex items-center gap-2 text-[13px] font-medium text-[#444746]"><span>ChefAI Studio</span><span className="text-[#bdc1c6] text-sm">/</span><span className="text-[#1f1f1f] font-bold">{state.view.toUpperCase()}</span></div></header>
                        <main className="flex-1 overflow-y-auto custom-scrollbar p-6">
                            <div className="max-w-6xl mx-auto h-full">
                                {state.view === 'home' && <HomeView {...state} />}
                                {state.view === 'genie' && <GenieView {...state} />}
                                {state.view === 'cookbook' && <HistoryView {...state} />}
                                {state.view === 'shopping' && <ShoppingView {...state} />}
                                {state.view === 'profile' && <ProfileView {...state} recipeCount={state.savedRecipes.length} cartCount={state.shoppingCart.length} />}
                            </div>
                        </main>
                    </div>

                    <nav className="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-[#dadce0] flex justify-around items-center py-2 px-2 z-50 shadow-xl">
                        {['home','genie','cookbook','shopping','profile'].map(v => (
                            <button key={v} onClick={() => state.setView(v)} className={`p-3 rounded-xl ${state.view === v ? 'bg-[#e8f0fe] text-[#0b57d0]' : 'text-[#444746]'}`}>
                                {v === 'home' && <Home className="w-6 h-6"/>}
                                {v === 'genie' && <Wand2 className="w-6 h-6"/>}
                                {v === 'cookbook' && <BookOpen className="w-6 h-6"/>}
                                {v === 'shopping' && <ShoppingCart className="w-6 h-6"/>}
                                {v === 'profile' && <UserCircle className="w-6 h-6"/>}
                            </button>
                        ))}
                    </nav>

                    {state.activeRecipe && (
                        <RecipeModal 
                            recipe={state.activeRecipe} 
                            setRecipe={state.setActiveRecipe} 
                            close={() => state.setActiveRecipe(null)}
                            isEditing={state.isEditing} setIsEditing={state.setIsEditing}
                            scalingFactor={state.scalingFactor} setScalingFactor={state.setScalingFactor}
                            saveRecipe={state.handleSaveRecipeAction} updateRecipe={state.handleUpdateRecipeAction}
                            saving={state.saving} saveError={state.saveError}
                            refine={state.handleRefineAction} refining={state.refining}
                            refinePrompt={state.refinePrompt} setRefinePrompt={state.setRefinePrompt}
                            refineError={state.refineError}
                            shoppingCart={state.shoppingCart} onAddToCart={state.addToCart} onRemoveFromCart={state.removeFromCart}
                        />
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ChefAIApp />);
    </script>
</body>
</html>